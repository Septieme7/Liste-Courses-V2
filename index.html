<!DOCTYPE html>
<html lang="fr" data-theme="light" data-color="blue">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="description" content="Courses Malin â€“ GÃ©rez vos listes de courses, suivez votre budget et organisez vos achats intelligemment.">
  <meta name="theme-color" content="#3B82F6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>Courses Malin Â· Liste & Budget</title>
  <link rel="apple-touch-icon" sizes="180x180" href="assets/icon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/icon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/icon/favicon-16x16.png">
  <link rel="manifest" href="assets/manifest/site.webmanifest">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/style2.css">
  <!-- Cropper.js pour l'Ã©dition d'image -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css" />
</head>
<body>

  <header id="hdr" role="banner">
    <button class="hbtn" id="btnBack" aria-label="Retour Ã  l'accueil" style="display: none;">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <line x1="19" y1="12" x2="5" y2="12"/>
        <polyline points="12 19 5 12 12 5"/>
      </svg>
    </button>
    <div class="htitle-wrap">
      <img src="assets/images/LogoCourses.png" alt="" class="hlogo" id="headerLogo" aria-hidden="false" role="button" tabindex="0" aria-label="Afficher le logo en grand">
      <h1 id="htitle">Mes Courses</h1>
    </div>
    <button class="hbtn pri" id="btnAdd" aria-label="Ajouter un article">
      <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
        <line x1="12" y1="5" x2="12" y2="19"/>
        <line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
    </button>
  </header>

  <main id="content" role="main">
    <!-- ACCUEIL -->
    <section class="view on" id="v-home" aria-label="Accueil">
      <div class="card bcard" aria-label="Suivi du budget">
        <div class="brow">
          <span class="btag" data-i18n="home.budget">ğŸ’° Budget</span>
          <div class="btotal">
            <input type="number" id="budgetIn" step="1" min="0" value="50" aria-label="Budget total en euros" inputmode="decimal">
            <span aria-hidden="true">â‚¬</span>
          </div>
        </div>
        <div class="bstats">
          <div class="bst">
            <div class="bst-lbl" data-i18n="home.spent">DÃ©pensÃ©</div>
            <div class="bst-val" id="spentV" aria-live="polite">0.00 â‚¬</div>
          </div>
          <div class="bst">
            <div class="bst-lbl" id="remLbl" data-i18n="home.remaining">Restant</div>
            <div class="bst-val" id="remV" aria-live="polite">50.00 â‚¬</div>
          </div>
        </div>
        <div class="pbar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" id="pbarWrap">
          <div class="pfill" id="pfill" style="width:0%"></div>
        </div>
        <div class="balert" id="balert" role="alert" aria-live="assertive">
          âš ï¸ <span id="balertTxt"></span>
        </div>
      </div>

      <div class="alist" aria-label="Liste active sÃ©lectionnÃ©e">
        <span id="aListIco" aria-hidden="true">ğŸ›’</span>
        <div class="alist-info">
          <div class="alist-sub" data-i18n="home.active_list">Liste active</div>
          <div class="alist-name" id="aListName">Aucune liste</div>
        </div>
        <button class="alist-share" id="btnShare" aria-label="Partager la liste">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <circle cx="18" cy="5" r="3"/>
            <circle cx="6" cy="12" r="3"/>
            <circle cx="18" cy="19" r="3"/>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
          </svg>
        </button>
        <!-- Nouveau bouton : importer une autre liste -->
        <button class="alist-share" id="btnImportToList" aria-label="Importer une autre liste">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
        </button>
        <button class="alist-chg" id="btnChangeList" data-i18n="home.change_list" aria-label="Changer de liste active">Changer</button>
      </div>

      <div id="listMapContainer" style="margin-bottom: 12px; display: none;">
        <div class="card" style="padding: 12px;">
          <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
            <span style="font-weight: 600;" data-i18n="home.map_title">ğŸ—ºï¸ Carte du magasin</span>
            <button class="sact-btn" id="viewMapBtn" data-i18n="home.view_map" style="padding: 5px 12px;">Voir</button>
            <button class="sact-btn sact-muted" id="changeMapBtn" data-i18n="home.change_map" style="padding: 5px 12px;">Changer</button>
            <button class="sact-btn sact-danger" id="deleteMapBtn" data-i18n="home.delete_map" style="padding: 5px 12px;">Supprimer</button>
            <button class="sact-btn sact-muted" id="locateStoreBtn" data-i18n="home.locate_store" style="padding: 5px 12px;">ğŸ“ Localiser</button>
            <!-- Nouveau bouton itinÃ©raire -->
            <button class="sact-btn sact-muted" id="routeStoreBtn" data-i18n="home.route_store" style="padding: 5px 12px;">ğŸ§­ ItinÃ©raire</button>
          </div>
          <img id="mapThumb" src="" alt="Carte" style="max-width: 100%; max-height: 150px; margin-top: 8px; border-radius: var(--r-xs); display: none; cursor: pointer;">
        </div>
      </div>

      <div class="sbar" role="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <circle cx="11" cy="11" r="8"/>
          <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <input type="search" id="searchIn" data-i18n="home.search_placeholder" placeholder="Rechercher un articleâ€¦" aria-label="Rechercher dans la liste" autocomplete="off">
      </div>

      <div class="card" id="itemsCont" aria-label="Articles de la liste">
        <div class="empty" id="emptyState" style="cursor: pointer;" role="button" tabindex="0" aria-label="Ajouter un article ou crÃ©er une liste">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
            <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
            <line x1="3" y1="6" x2="21" y2="6"/>
            <path d="M16 10a4 4 0 01-8 0"/>
          </svg>
          <h2 data-i18n="home.empty_title">Liste vide</h2>
          <p data-i18n="home.empty_text">Appuyez sur + pour ajouter votre premier article</p>
        </div>
        <ul id="itemsList" aria-label="Articles"></ul>
      </div>

      <div class="tbar" aria-label="RÃ©sumÃ©">
        <span class="tbar-lbl" data-i18n="home.total_articles">Total articles</span>
        <span class="tbar-val" id="totCount" aria-live="polite">0 article</span>
      </div>
    </section>

    <!-- MES LISTES -->
    <section class="view" id="v-lists" aria-label="Mes listes de courses">
      <div class="vhdr">
        <h2 data-i18n="lists.title">Mes Listes</h2>
        <button class="addbtn" id="btnNewList" aria-label="CrÃ©er une nouvelle liste">
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          <span data-i18n="lists.new_list">Nouvelle</span>
        </button>
      </div>
      <div style="display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap;">
        <button class="sact-btn" id="btnExportLists" data-i18n="lists.export">ğŸ“¤ Exporter les listes</button>
        <button class="sact-btn" id="btnImportLists" data-i18n="lists.import">ğŸ“¥ Importer un fichier</button>
        <!-- Nouveau bouton : partage texte -->
        <button class="sact-btn" id="btnShareListsText" data-i18n="lists.share_text">ğŸ“¤ Partager en texte</button>
      </div>
      <div class="lgrid" id="lgrid" role="list" aria-label="Listes de courses"></div>
      <div class="empty" id="listsEmpty" style="display:none" aria-live="polite">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
          <rect x="3" y="3" width="18" height="18" rx="2"/>
          <line x1="8" y1="8" x2="16" y2="8"/>
          <line x1="8" y1="12" x2="16" y2="12"/>
          <line x1="8" y1="16" x2="12" y2="16"/>
        </svg>
        <h2 data-i18n="lists.empty_title">Aucune liste</h2>
        <p data-i18n="lists.empty_text">CrÃ©ez votre premiÃ¨re liste de courses</p>
      </div>
    </section>

    <!-- RÃ‰GLAGES -->
    <section class="view" id="v-settings" aria-label="RÃ©glages de l'application">
      <h2 class="vtitle" data-i18n="settings.title">RÃ©glages</h2>
      <div class="ssec">
        <p class="stitle" data-i18n="settings.appearance">Apparence</p>
        <div class="sgroup">
          <div class="srow">
            <span class="slbl" data-i18n="settings.dark_mode">Mode sombre</span>
            <button class="tog" id="darkTog" role="switch" aria-checked="false" aria-label="Activer le mode sombre"></button>
          </div>
          <div class="srow srow-col">
            <span class="slbl" data-i18n="settings.primary_color">Couleur principale</span>
            <div class="cgrid" id="cGrid" role="group" aria-label="Choisir la couleur principale"></div>
          </div>
          <div class="srow">
            <span class="slbl" data-i18n="settings.language">Langue</span>
            <select id="langSelector" class="ssel" aria-label="Langue">
              <option value="fr">FranÃ§ais</option>
              <option value="en">English</option>
              <option value="es">EspaÃ±ol</option>
              <option value="zh">ä¸­æ–‡</option>
              <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            </select>
          </div>
        </div>
      </div>
      <div class="ssec">
        <p class="stitle" data-i18n="settings.budget_alert">Alerte Budget</p>
        <div class="sgroup">
          <div class="srow">
            <span class="slbl" data-i18n="settings.enable_sound">Activer l'alerte sonore</span>
            <button class="tog" id="soundTog" role="switch" aria-checked="true" aria-label="Activer ou dÃ©sactiver l'alerte sonore"></button>
          </div>
          <div class="srow">
            <span class="slbl" data-i18n="settings.sound">Son d'alerte</span>
            <select class="ssel" id="soundSel" aria-label="Choisir le son d'alerte">
              <option value="A">Son A</option>
              <option value="B">Son B</option>
              <option value="C">Son C</option>
              <option value="D">Son D</option>
              <option value="E">Son E</option>
              <option value="F">Son F</option>
              <option value="G">Son G</option>
            </select>
          </div>
          <div class="srow">
            <span class="slbl" data-i18n="settings.test_sound">Tester le son</span>
            <button class="sact-btn" id="btnPlaySound" aria-label="Tester le son d'alerte">â–¶</button>
          </div>
          <div class="srow">
            <span class="slbl" data-i18n="settings.stop_sound">ArrÃªter le son</span>
            <button class="sact-btn sact-muted" id="btnStopSound" aria-label="ArrÃªter le son d'alerte">â¹</button>
          </div>
          <div class="srow">
            <span class="slbl" data-i18n="settings.thresholds">Seuils d'alerte</span>
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              <label class="threshold-checkbox"><input type="checkbox" id="threshold50" checked> 50%</label>
              <label class="threshold-checkbox"><input type="checkbox" id="threshold80" checked> 80%</label>
              <label class="threshold-checkbox"><input type="checkbox" id="threshold100" checked> 100%</label>
            </div>
          </div>
        </div>
      </div>
      <div class="ssec">
        <p class="stitle" data-i18n="settings.tools">Outils</p>
        <div class="sgroup">
          <div class="srow">
            <span class="slbl" data-i18n="settings.calculator">Calculateur Conso</span>
            <a href="https://septieme7.github.io/Conso-Comptoir/" target="_blank" rel="noopener noreferrer" class="sact-btn" aria-label="Ouvrir la calculatrice (nouvel onglet)">ğŸ§®</a>
          </div>
          <div class="srow">
            <span class="slbl" data-i18n="settings.help">Aide</span>
            <button class="sact-btn" id="btnHelp" data-i18n="settings.help_button" aria-label="Aide">Ouvrir</button>
          </div>
          <div class="srow">
            <span class="slbl sbl-danger" data-i18n="settings.reset">RÃ©initialiser toutes les donnÃ©es</span>
            <button class="sact-btn sact-danger" id="btnReset" data-i18n="settings.reset_button" aria-label="Effacer toutes les donnÃ©es">Effacer</button>
          </div>
        </div>
      </div>
      <p class="app-version">Courses Malin Â· v2.3</p>
    </section>

    <!-- AIDE -->
    <section class="view" id="v-help" aria-label="Aide">
      <h2 class="vtitle" data-i18n="help.title">Aide</h2>
      <div class="card" style="padding: 16px;">
        <div class="ssec">
          <p class="stitle" data-i18n="help.overview">Vue d'ensemble</p>
          <p data-i18n="help.overview_text">Courses Malin vous aide Ã  gÃ©rer vos listes de courses, suivre votre budget et organiser vos achats.</p>
        </div>
        <div class="ssec">
          <p class="stitle" data-i18n="help.features">FonctionnalitÃ©s principales</p>
          <ul style="list-style: disc; padding-left: 20px;">
            <li data-i18n="help.feature_lists">ğŸ“‹ CrÃ©ation et gestion de plusieurs listes</li>
            <li data-i18n="help.feature_scan">ğŸ“· Scan de codes-barres (via Open Food Facts)</li>
            <li data-i18n="help.feature_budget">ğŸ’° Suivi du budget avec alertes personnalisables</li>
            <li data-i18n="help.feature_map">ğŸ—ºï¸ Carte du magasin associÃ©e Ã  chaque liste</li>
            <li data-i18n="help.feature_export">ğŸ“¤ Export/Import CSV</li>
            <li data-i18n="help.feature_custom">ğŸ¨ Personnalisation des thÃ¨mes et de la langue</li>
            <li data-i18n="help.feature_location">ğŸ“ Localisation du magasin : enregistrez l'adresse et visualisez-la</li>
            <li data-i18n="help.feature_units">âš–ï¸ UnitÃ©s de mesure (kg, L, piÃ¨ce) et prix au kilo</li>
            <li data-i18n="help.feature_dragdrop">ğŸ–±ï¸ Glisser-dÃ©poser pour rÃ©organiser les articles</li>
            <li data-i18n="help.feature_voice">ğŸ¤ Saisie vocale des articles</li>
          </ul>
        </div>
        <div class="ssec">
          <p class="stitle" data-i18n="help.tips">Astuces</p>
          <p data-i18n="help.tip_units">â€¢ Pour les articles au poids, choisissez l'unitÃ© 'kg' et saisissez le prix au kilo pour un calcul automatique.</p>
          <p data-i18n="help.tip_drag">â€¢ Pour dÃ©placer un article, appuyez longuement sur son nom et glissez-le.</p>
          <p data-i18n="help.tip_voice">â€¢ Utilisez le microphone dans le formulaire d'ajout pour dicter le nom de l'article.</p>
          <p data-i18n="help.tip_location">â€¢ La localisation du magasin vous aide Ã  retrouver son adresse (pas de notification automatique).</p>
          <p data-i18n="help.tip_thresholds">â€¢ Dans les rÃ©glages, vous pouvez choisir Ã  quels seuils de budget dÃ©clencher une alerte.</p>
        </div>
        <div class="ssec">
          <p class="stitle" data-i18n="help.support">Support</p>
          <p data-i18n="help.support_text">Pour toute question, ouvrez une issue sur <a href="https://github.com/Septieme7/Liste-Courses-V2" target="_blank">GitHub</a>.</p>
        </div>
      </div>
    </section>
  </main>

  <nav id="nav" role="navigation" aria-label="Navigation principale">
    <button class="tab on" id="t-home" aria-label="Accueil" aria-current="page">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
        <polyline points="9 22 9 12 15 12 15 22"/>
      </svg>
      <span data-i18n="nav.home">Accueil</span>
    </button>
    <button class="tab" id="t-lists" aria-label="Mes Listes">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <line x1="8" y1="6" x2="21" y2="6"/>
        <line x1="8" y1="12" x2="21" y2="12"/>
        <line x1="8" y1="18" x2="21" y2="18"/>
        <line x1="3" y1="6" x2="3.01" y2="6"/>
        <line x1="3" y1="12" x2="3.01" y2="12"/>
        <line x1="3" y1="18" x2="3.01" y2="18"/>
      </svg>
      <span data-i18n="nav.lists">Mes Listes</span>
    </button>
    <button class="tab" id="t-settings" aria-label="RÃ©glages">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <circle cx="12" cy="12" r="3"/>
        <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/>
      </svg>
      <span data-i18n="nav.settings">RÃ©glages</span>
    </button>
  </nav>

  <button id="fab" class="pulse" aria-label="Ajouter un article">
    <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
      <line x1="12" y1="5" x2="12" y2="19"/>
      <line x1="5" y1="12" x2="19" y2="12"/>
    </svg>
  </button>

  <div id="ovl" aria-hidden="true"></div>

  <!-- Bottom Sheet : Ajouter / Modifier un article -->
  <div class="sheet" id="shItem" role="dialog" aria-modal="true" aria-labelledby="shItemTitle">
    <div class="shandle" aria-hidden="true"></div>
    <h2 class="stit" id="shItemTitle">Ajouter un article</h2>
    <div class="sbody">
      <div class="fld">
        <label data-i18n="item.quick_suggestions">Suggestions rapides <span class="hint" data-i18n="item.click_to_add">(cliquez pour cumuler)</span></label>
        <div class="chips" id="qChips" role="group" aria-label="Suggestions rapides"></div>
      </div>

      <div class="fld">
        <label for="iName">
          <span data-i18n="item.name_label">Nom</span>
          <span aria-hidden="true">*</span>
          <span class="hint" data-i18n="item.name_hint"> â€” sÃ©parez par une virgule pour en ajouter plusieurs</span>
        </label>
        <div style="display: flex; gap: 8px;">
          <input type="text" id="iName" data-i18n="item.name_placeholder" placeholder="Ex : Pain, Lait, Beurreâ€¦" autocomplete="off" aria-required="true" aria-describedby="iNameHint" style="flex: 1;">
          <button type="button" id="btnScanBarcode" class="sact-btn" style="padding: 0 12px; white-space: nowrap;" data-i18n="item.scan_button" aria-label="Scanner un code-barres">ğŸ“· Scanner</button>
          <button type="button" id="btnSpeech" class="sact-btn" style="padding: 0 12px;" aria-label="Ajouter par la voix">ğŸ¤</button>
        </div>
        <p class="multi-hint" id="iNameHint"></p>
      </div>

      <!-- Mode scan multiple -->
      <div class="fld" style="display: flex; align-items: center; justify-content: space-between;">
        <label for="multiScanToggle" data-i18n="item.multi_scan">Mode scan multiple</label>
        <button class="tog" id="multiScanToggle" role="switch" aria-checked="false"></button>
      </div>

      <!-- Conteneur pour la camÃ©ra -->
      <div id="scannerContainer" style="display: none; margin-top: 10px; border-radius: var(--r-sm); overflow: hidden; background: #000; min-height: 250px;">
        <div id="qr-reader" style="width: 100%;"></div>
        <div style="display: flex; gap: 8px; padding: 8px; justify-content: center;">
          <button class="sact-btn sact-muted" id="btnStopScan" data-i18n="item.stop_scan">ArrÃªter</button>
        </div>
        <!-- Panneau de rÃ©sultat pour le scan multiple -->
        <div id="scanResultPanel" style="display: none; background: var(--sur); padding: 10px; border-radius: 8px; margin-top: 8px;">
          <div id="scanProductName" style="font-weight: 600; margin-bottom: 5px;"></div>
          <div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">
            <button class="sact-btn sact-muted" id="scanIgnoreBtn" data-i18n="item.scan_ignore">Ignorer</button>
            <button class="sact-btn" id="scanAddBtn" data-i18n="item.scan_add">Ajouter</button>
            <button class="sact-btn sact-danger" id="scanStopBtn" data-i18n="item.scan_stop">ArrÃªter</button>
          </div>
        </div>
      </div>

      <div class="fld" id="fldQty">
        <label id="qtyLbl" data-i18n="item.quantity">QuantitÃ©</label>
        <div class="stepper" role="group" aria-labelledby="qtyLbl">
          <button class="stbtn" id="qtyMinus" aria-label="Diminuer la quantitÃ©">âˆ’</button>
          <span class="stval" id="qDisp" aria-live="polite">1</span>
          <button class="stbtn" id="qtyPlus" aria-label="Augmenter la quantitÃ©">+</button>
        </div>
      </div>
      <div class="fld" id="fldPrice">
        <label for="iPrice" data-i18n="item.price_label">Prix unitaire (â‚¬)</label>
        <input type="number" id="iPrice" data-i18n="item.price_placeholder" placeholder="0.00" step="0.01" min="0" inputmode="decimal">
      </div>

      <!-- UnitÃ© et prix au kilo -->
      <div class="fld" id="fldUnit">
        <label for="iUnit" data-i18n="item.unit_label">UnitÃ©</label>
        <select id="iUnit">
          <option value="pce" data-i18n="units.piece">piÃ¨ce</option>
          <option value="kg" data-i18n="units.kg">kilogramme (kg)</option>
          <option value="g" data-i18n="units.g">gramme (g)</option>
          <option value="l" data-i18n="units.l">litre (L)</option>
          <option value="ml" data-i18n="units.ml">millilitre (mL)</option>
          <option value="pack" data-i18n="units.pack">paquet</option>
        </select>
      </div>
      <div class="fld" id="fldPricePerUnit" style="display: none;">
        <label for="iPricePerUnit" data-i18n="item.price_per_unit_label">Prix au kg/L (â‚¬)</label>
        <input type="number" id="iPricePerUnit" step="0.01" min="0" placeholder="0.00">
      </div>

      <div class="fld">
        <label for="iCat" data-i18n="item.category_label">CatÃ©gorie</label>
        <select id="iCat">
          <option value="" data-i18n="item.no_category">Sans catÃ©gorie</option>
          <option value="ğŸ¥¦ Fruits &amp; LÃ©gumes" data-i18n="category.fruits">ğŸ¥¦ Fruits & LÃ©gumes</option>
          <option value="ğŸ¥© Viandes &amp; Poissons" data-i18n="category.meat">ğŸ¥© Viandes & Poissons</option>
          <option value="ğŸ¥› Produits Laitiers" data-i18n="category.dairy">ğŸ¥› Produits Laitiers</option>
          <option value="ğŸ¥– Boulangerie" data-i18n="category.bakery">ğŸ¥– Boulangerie</option>
          <option value="ğŸ¥« Ã‰picerie" data-i18n="category.grocery">ğŸ¥« Ã‰picerie</option>
          <option value="ğŸ§´ HygiÃ¨ne" data-i18n="category.hygiene">ğŸ§´ HygiÃ¨ne</option>
          <option value="ğŸ§¹ Entretien" data-i18n="category.cleaning">ğŸ§¹ Entretien</option>
          <option value="ğŸ§ƒ Boissons" data-i18n="category.drinks">ğŸ§ƒ Boissons</option>
          <option value="ğŸ¦ SurgelÃ©s" data-i18n="category.frozen">ğŸ¦ SurgelÃ©s</option>
          <option value="ğŸ’• Love" data-i18n="category.love">ğŸ’• Love</option>
          <option value="ğŸ¤¬ SaMÃ©reList" data-i18n="category.mother">ğŸ¤¬ SaMÃ©reList</option>
          <option value="ğŸ–• Sheet List" data-i18n="category.sheet">ğŸ–• Sheet List</option>
          <option value="ğŸ§™â€â™‚ï¸ Magic List" data-i18n="category.magic">ğŸ§™â€â™‚ï¸ Magic List</option>
        </select>
      </div>
      <div class="fld" id="fldNote">
        <label for="iNote" data-i18n="item.note_label">Note / Marque</label>
        <textarea id="iNote" data-i18n="item.note_placeholder" placeholder="PrÃ©cisions, marque prÃ©fÃ©rÃ©eâ€¦"></textarea>
      </div>
      <button class="sbtn pri" id="iSubmit" data-i18n="item.add_button" disabled>Ajouter</button>
    </div>
  </div>

  <!-- Bottom Sheet : CrÃ©er une liste -->
  <div class="sheet" id="shList" role="dialog" aria-modal="true" aria-labelledby="shListTitle">
    <div class="shandle" aria-hidden="true"></div>
    <h2 class="stit" id="shListTitle" data-i18n="lists.new_list_title">Nouvelle liste</h2>
    <div class="sbody">
      <div class="fld">
        <label for="lName" data-i18n="lists.name_label">Nom <span aria-hidden="true">*</span></label>
        <input type="text" id="lName" data-i18n="lists.name_placeholder" placeholder="Ex : SupermarchÃ©, Semaineâ€¦" autocomplete="off" aria-required="true">
      </div>
      <div class="fld">
        <label for="lEmoji" data-i18n="lists.emoji_label">Emoji</label>
        <div class="chips" id="eChips" role="group" aria-label="Choisir un emoji"></div>
        <input type="text" id="lEmoji" value="ğŸ›’" maxlength="4" class="emoji-input" aria-label="Emoji de la liste">
      </div>
      <div class="fld">
        <label data-i18n="lists.color_label">Couleur</label>
        <div class="cgrid" id="lCGrid" role="group" aria-label="Choisir la couleur de la liste"></div>
        <input type="hidden" id="lColor" value="#3B82F6">
      </div>
      <button class="sbtn pri" id="lSubmit" data-i18n="lists.create_button" disabled>CrÃ©er la liste</button>
    </div>
  </div>

  <!-- Bottom Sheet : Ã‰diteur d'image (recadrage, rotation) -->
  <div class="sheet" id="shImageEditor" role="dialog" aria-modal="true" aria-labelledby="shImageTitle">
    <div class="shandle" aria-hidden="true"></div>
    <h2 class="stit" id="shImageTitle">Ã‰diter l'image</h2>
    <div class="sbody">
      <div style="max-height: 50vh; overflow: hidden; margin-bottom: 16px;">
        <img id="imageToEdit" src="" style="max-width: 100%; display: block;">
      </div>
      <div style="display: flex; gap: 8px; justify-content: center; margin-bottom: 16px; flex-wrap: wrap;">
        <button class="sact-btn sact-muted" id="btnRotateLeft" aria-label="Tourner Ã  gauche">â†º 90Â°</button>
        <button class="sact-btn sact-muted" id="btnRotateRight" aria-label="Tourner Ã  droite">â†» 90Â°</button>
        <button class="sact-btn sact-muted" id="btnFlipHorizontal" aria-label="Retourner horizontalement">â†”</button>
        <button class="sact-btn sact-muted" id="btnFlipVertical" aria-label="Retourner verticalement">â†•</button>
      </div>
      <div style="display: flex; gap: 8px;">
        <button class="sbtn sact-muted" id="btnCancelImageEdit" style="flex:1;">Annuler</button>
        <button class="sbtn pri" id="btnSaveImageEdit" style="flex:1;">Valider</button>
      </div>
    </div>
  </div>

<!-- Bottom Sheet : Export de listes (et partage texte / import) -->
  <div class="sheet" id="shExport" role="dialog" aria-modal="true" aria-labelledby="shExportTitle">
    <div class="shandle" aria-hidden="true"></div>
    <h2 class="stit" id="shExportTitle" data-i18n="export.title">Exporter des listes</h2>
    <div class="sbody">
    <p data-i18n="export.select_prompt">SÃ©lectionnez les listes Ã  exporter :</p>
      <div id="exportListCheckboxes" style="margin: 16px 0;">
        <!-- Les checkboxes seront gÃ©nÃ©rÃ©es dynamiquement -->
      </div>
      <div style="display: flex; gap: 8px;">
        <button class="sbtn sact-muted" id="btnCancelExport" data-i18n="common.cancel" style="flex:1;">Annuler</button>
        <button class="sbtn pri" id="btnConfirmExport" data-i18n="export.confirm_button" style="flex:1;">Exporter</button>
      </div>
    </div>
  </div>

  <!-- Modal pour afficher le logo ou la carte en grand -->
  <div id="logoModal" class="modal" onclick="closeLogoModal()" role="dialog" aria-modal="true" aria-label="Logo agrandi" style="display: none;">
    <img src="assets/images/LogoCourses.png" alt="Logo Courses Malin">
  </div>

  <div id="snk" role="status" aria-live="polite"></div>

  <!-- BibliothÃ¨ques externes -->
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

  <!-- Nouveaux scripts -->
  <script src="assets/js/i18n.js"></script>
  <script src="assets/js/units.js"></script>
  <script src="assets/js/dragdrop.js"></script>
  <script src="assets/js/speech.js"></script>
  <script src="assets/js/geolocation.js"></script>
  <script src="assets/js/script.js"></script>
</body>
</html>