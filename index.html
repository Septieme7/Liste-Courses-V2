<!DOCTYPE html>
<html lang="fr" data-theme="light" data-color="blue">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="description" content="Courses Malin â€“ GÃ©rez vos listes de courses, suivez votre budget et organisez vos achats intelligemment.">
  <meta name="theme-color" content="#3B82F6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>Courses Malin Â· Liste & Budget</title>
  <link rel="apple-touch-icon" sizes="180x180" href="assets/icon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/icon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/icon/favicon-16x16.png">
  <link rel="manifest" href="assets/manifest/site.webmanifest">
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>

  <header id="hdr" role="banner">
    <button class="hbtn" id="btnBack" aria-label="Retour Ã  l'accueil" style="display: none;">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <line x1="19" y1="12" x2="5" y2="12"/>
        <polyline points="12 19 5 12 12 5"/>
      </svg>
    </button>
    <div class="htitle-wrap">
      <img src="assets/images/LogoCourses.png" alt="" class="hlogo" id="headerLogo" aria-hidden="false" role="button" tabindex="0" aria-label="Afficher le logo en grand">
      <h1 id="htitle">Mes Courses</h1>
    </div>
    <button class="hbtn pri" id="btnAdd" aria-label="Ajouter un article">
      <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
        <line x1="12" y1="5" x2="12" y2="19"/>
        <line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
    </button>
  </header>

  <main id="content" role="main">
    <section class="view on" id="v-home" aria-label="Accueil">
      <div class="card bcard" aria-label="Suivi du budget">
        <div class="brow">
          <span class="btag">ğŸ’° Budget</span>
          <div class="btotal">
            <input type="number" id="budgetIn" step="1" min="0" value="50" aria-label="Budget total en euros" inputmode="decimal">
            <span aria-hidden="true">â‚¬</span>
          </div>
        </div>
        <div class="bstats">
          <div class="bst">
            <div class="bst-lbl">DÃ©pensÃ©</div>
            <div class="bst-val" id="spentV" aria-live="polite">0.00 â‚¬</div>
          </div>
          <div class="bst">
            <div class="bst-lbl">Restant</div>
            <div class="bst-val ok" id="remV" aria-live="polite">50.00 â‚¬</div>
          </div>
        </div>
        <div class="pbar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" id="pbarWrap">
          <div class="pfill" id="pfill" style="width:0%"></div>
        </div>
        <div class="balert" id="balert" role="alert" aria-live="assertive">
          âš ï¸ <span id="balertTxt"></span>
        </div>
      </div>

      <div class="alist" aria-label="Liste active sÃ©lectionnÃ©e">
        <span id="aListIco" aria-hidden="true">ğŸ›’</span>
        <div class="alist-info">
          <div class="alist-sub">Liste active</div>
          <div class="alist-name" id="aListName">Aucune liste</div>
        </div>
        <button class="alist-share" id="btnShare" aria-label="Partager la liste">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <circle cx="18" cy="5" r="3"/>
            <circle cx="6" cy="12" r="3"/>
            <circle cx="18" cy="19" r="3"/>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
          </svg>
        </button>
        <button class="alist-chg" id="btnChangeList" aria-label="Changer de liste active">Changer</button>
      </div>

      <div id="listMapContainer" style="margin-bottom: 12px; display: none;">
        <div class="card" style="padding: 12px;">
          <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
            <span style="font-weight: 600;">ğŸ—ºï¸ Carte du magasin</span>
            <button class="sact-btn" id="viewMapBtn" style="padding: 5px 12px;">Voir</button>
            <button class="sact-btn sact-muted" id="changeMapBtn" style="padding: 5px 12px;">Changer</button>
            <button class="sact-btn sact-danger" id="deleteMapBtn" style="padding: 5px 12px;">Supprimer</button>
          </div>
          <img id="mapThumb" src="" alt="Carte" style="max-width: 100%; max-height: 150px; margin-top: 8px; border-radius: var(--r-xs); display: none;">
        </div>
      </div>

      <div class="sbar" role="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <circle cx="11" cy="11" r="8"/>
          <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <input type="search" id="searchIn" placeholder="Rechercher un articleâ€¦" aria-label="Rechercher dans la liste" autocomplete="off">
      </div>

      <div class="card" id="itemsCont" aria-label="Articles de la liste">
        <div class="empty" id="emptyState" style="cursor: pointer;" role="button" tabindex="0" aria-label="Ajouter un article ou crÃ©er une liste">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
            <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
            <line x1="3" y1="6" x2="21" y2="6"/>
            <path d="M16 10a4 4 0 01-8 0"/>
          </svg>
          <h2>Liste vide</h2>
          <p>Appuyez sur + pour ajouter votre premier article</p>
        </div>
        <ul id="itemsList" aria-label="Articles"></ul>
      </div>

      <div class="tbar" aria-label="RÃ©sumÃ©">
        <span class="tbar-lbl">Total articles</span>
        <span class="tbar-val" id="totCount" aria-live="polite">0 article</span>
      </div>
    </section>

    <section class="view" id="v-lists" aria-label="Mes listes de courses">
      <div class="vhdr">
        <h2>Mes Listes</h2>
        <button class="addbtn" id="btnNewList" aria-label="CrÃ©er une nouvelle liste">
          <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Nouvelle
        </button>
      </div>
      <div class="lgrid" id="lgrid" role="list" aria-label="Listes de courses"></div>
      <div class="empty" id="listsEmpty" style="display:none" aria-live="polite">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
          <rect x="3" y="3" width="18" height="18" rx="2"/>
          <line x1="8" y1="8" x2="16" y2="8"/>
          <line x1="8" y1="12" x2="16" y2="12"/>
          <line x1="8" y1="16" x2="12" y2="16"/>
        </svg>
        <h2>Aucune liste</h2>
        <p>CrÃ©ez votre premiÃ¨re liste de courses</p>
      </div>
    </section>

    <section class="view" id="v-settings" aria-label="RÃ©glages de l'application">
      <h2 class="vtitle">RÃ©glages</h2>
      <div class="ssec">
        <p class="stitle">Apparence</p>
        <div class="sgroup">
          <div class="srow">
            <span class="slbl">Mode sombre</span>
            <button class="tog" id="darkTog" role="switch" aria-checked="false" aria-label="Activer le mode sombre"></button>
          </div>
          <div class="srow srow-col">
            <span class="slbl">Couleur principale</span>
            <div class="cgrid" id="cGrid" role="group" aria-label="Choisir la couleur principale"></div>
          </div>
        </div>
      </div>
      <div class="ssec">
        <p class="stitle">Alerte Budget</p>
        <div class="sgroup">
          <div class="srow">
            <span class="slbl">Activer l'alerte sonore</span>
            <button class="tog" id="soundTog" role="switch" aria-checked="true" aria-label="Activer ou dÃ©sactiver l'alerte sonore"></button>
          </div>
          <div class="srow">
            <span class="slbl">Son d'alerte</span>
            <select class="ssel" id="soundSel" aria-label="Choisir le son d'alerte">
              <option value="A">Son A</option>
              <option value="B">Son B</option>
              <option value="C">Son C</option>
              <option value="D">Son D</option>
              <option value="E">Son E</option>
              <option value="F">Son F</option>
              <option value="G">Son G</option>
            </select>
          </div>
          <div class="srow">
            <span class="slbl">Tester le son</span>
            <button class="sact-btn" id="btnPlaySound" aria-label="Tester le son d'alerte">â–¶ Test</button>
          </div>
          <div class="srow">
            <span class="slbl">ArrÃªter le son</span>
            <button class="sact-btn sact-muted" id="btnStopSound" aria-label="ArrÃªter le son d'alerte">â¹ Stop</button>
          </div>
        </div>
      </div>
      <div class="ssec">
        <p class="stitle">Outils</p>
        <div class="sgroup">
          <div class="srow">
            <span class="slbl">Calculatrice Conso</span>
            <a href="https://calcul-conso.netlify.app/" target="_blank" rel="noopener noreferrer" class="sact-btn" aria-label="Ouvrir la calculatrice (nouvel onglet)">ğŸ§® Ouvrir</a>
          </div>
          <div class="srow">
            <span class="slbl sbl-danger">RÃ©initialiser toutes les donnÃ©es</span>
            <button class="sact-btn sact-danger" id="btnReset" aria-label="Effacer toutes les donnÃ©es">Effacer</button>
          </div>
        </div>
      </div>
      <p class="app-version">Courses Malin Â· v2.1</p>
    </section>
  </main>

  <nav id="nav" role="navigation" aria-label="Navigation principale">
    <button class="tab on" id="t-home" aria-label="Accueil" aria-current="page">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
        <polyline points="9 22 9 12 15 12 15 22"/>
      </svg>
      Accueil
    </button>
    <button class="tab" id="t-lists" aria-label="Mes Listes">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <line x1="8" y1="6" x2="21" y2="6"/>
        <line x1="8" y1="12" x2="21" y2="12"/>
        <line x1="8" y1="18" x2="21" y2="18"/>
        <line x1="3" y1="6" x2="3.01" y2="6"/>
        <line x1="3" y1="12" x2="3.01" y2="12"/>
        <line x1="3" y1="18" x2="3.01" y2="18"/>
      </svg>
      Mes Listes
    </button>
    <button class="tab" id="t-settings" aria-label="RÃ©glages">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <circle cx="12" cy="12" r="3"/>
        <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/>
      </svg>
      RÃ©glages
    </button>
  </nav>

  <button id="fab" class="pulse" aria-label="Ajouter un article">
    <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
      <line x1="12" y1="5" x2="12" y2="19"/>
      <line x1="5" y1="12" x2="19" y2="12"/>
    </svg>
  </button>

  <div id="ovl" aria-hidden="true"></div>

  <!-- Bottom Sheet : Ajouter / Modifier un article -->
  <div class="sheet" id="shItem" role="dialog" aria-modal="true" aria-labelledby="shItemTitle">
    <div class="shandle" aria-hidden="true"></div>
    <h2 class="stit" id="shItemTitle">Ajouter un article</h2>
    <div class="sbody">
      <div class="fld">
        <label>Suggestions rapides <span class="hint">(cliquez pour cumuler)</span></label>
        <div class="chips" id="qChips" role="group" aria-label="Suggestions rapides"></div>
      </div>

      <!-- Champ Nom avec bouton Scanner -->
      <div class="fld">
        <label for="iName">
          Nom
          <span aria-hidden="true">*</span>
          <span class="hint"> â€” sÃ©parez par une virgule pour en ajouter plusieurs</span>
        </label>
        <div style="display: flex; gap: 8px;">
          <input type="text" id="iName" placeholder="Ex : Pain, Lait, Beurreâ€¦" autocomplete="off" aria-required="true" aria-describedby="iNameHint" style="flex: 1;">
          <button type="button" id="btnScanBarcode" class="sact-btn" style="padding: 0 12px; white-space: nowrap;" aria-label="Scanner un code-barres">ğŸ“· Scanner</button>
        </div>
        <p class="multi-hint" id="iNameHint"></p>
      </div>

      <!-- Conteneur vidÃ©o pour le scan (cachÃ© par dÃ©faut) -->
      <div id="scannerContainer" style="display: none; margin-top: 10px; border-radius: var(--r-sm); overflow: hidden; background: #000;">
        <video id="scannerVideo" style="width: 100%; height: auto;"></video>
        <div style="display: flex; gap: 8px; padding: 8px; justify-content: center;">
          <button class="sact-btn sact-muted" id="btnStopScan">ArrÃªter</button>
        </div>
      </div>

      <div class="fld" id="fldQty">
        <label id="qtyLbl">QuantitÃ©</label>
        <div class="stepper" role="group" aria-labelledby="qtyLbl">
          <button class="stbtn" id="qtyMinus" aria-label="Diminuer la quantitÃ©">âˆ’</button>
          <span class="stval" id="qDisp" aria-live="polite">1</span>
          <button class="stbtn" id="qtyPlus" aria-label="Augmenter la quantitÃ©">+</button>
        </div>
      </div>
      <div class="fld" id="fldPrice">
        <label for="iPrice">Prix unitaire (â‚¬)</label>
        <input type="number" id="iPrice" placeholder="0.00" step="0.01" min="0" inputmode="decimal">
      </div>
      <div class="fld">
        <label for="iCat">CatÃ©gorie</label>
        <select id="iCat">
          <option value="">Sans catÃ©gorie</option>
          <option value="ğŸ¥¦ Fruits &amp; LÃ©gumes">ğŸ¥¦ Fruits &amp; LÃ©gumes</option>
          <option value="ğŸ¥© Viandes &amp; Poissons">ğŸ¥© Viandes &amp; Poissons</option>
          <option value="ğŸ¥› Produits Laitiers">ğŸ¥› Produits Laitiers</option>
          <option value="ğŸ¥– Boulangerie">ğŸ¥– Boulangerie</option>
          <option value="ğŸ¥« Ã‰picerie">ğŸ¥« Ã‰picerie</option>
          <option value="ğŸ§´ HygiÃ¨ne">ğŸ§´ HygiÃ¨ne</option>
          <option value="ğŸ§¹ Entretien">ğŸ§¹ Entretien</option>
          <option value="ğŸ§ƒ Boissons">ğŸ§ƒ Boissons</option>
          <option value="ğŸ¦ SurgelÃ©s">ğŸ¦ SurgelÃ©s</option>
        </select>
      </div>
      <div class="fld" id="fldNote">
        <label for="iNote">Note / Marque</label>
        <textarea id="iNote" placeholder="PrÃ©cisions, marque prÃ©fÃ©rÃ©eâ€¦"></textarea>
      </div>
      <button class="sbtn pri" id="iSubmit" disabled>Ajouter</button>
    </div>
  </div>

  <!-- Bottom Sheet : CrÃ©er une liste -->
  <div class="sheet" id="shList" role="dialog" aria-modal="true" aria-labelledby="shListTitle">
    <div class="shandle" aria-hidden="true"></div>
    <h2 class="stit" id="shListTitle">Nouvelle liste</h2>
    <div class="sbody">
      <div class="fld">
        <label for="lName">Nom <span aria-hidden="true">*</span></label>
        <input type="text" id="lName" placeholder="Ex : SupermarchÃ©, Semaineâ€¦" autocomplete="off" aria-required="true">
      </div>
      <div class="fld">
        <label for="lEmoji">Emoji</label>
        <div class="chips" id="eChips" role="group" aria-label="Choisir un emoji"></div>
        <input type="text" id="lEmoji" value="ğŸ›’" maxlength="4" class="emoji-input" aria-label="Emoji de la liste">
      </div>
      <div class="fld">
        <label>Couleur</label>
        <div class="cgrid" id="lCGrid" role="group" aria-label="Choisir la couleur de la liste"></div>
        <input type="hidden" id="lColor" value="#3B82F6">
      </div>
      <button class="sbtn pri" id="lSubmit" disabled>CrÃ©er la liste</button>
    </div>
  </div>

  <!-- Modal pour afficher le logo ou la carte en grand -->
  <div id="logoModal" class="modal" onclick="closeLogoModal()" role="dialog" aria-modal="true" aria-label="Logo agrandi" style="display: none;">
    <img src="assets/images/LogoCourses.png" alt="Logo Courses Malin">
  </div>

  <div id="snk" role="status" aria-live="polite"></div>

  <!-- Instascan pour le scan de code-barres -->
  <script src="https://cdn.jsdelivr.net/npm/instascan@1.0.0-beta.3/instascan.min.js"></script>
  <script src="assets/js/script.js"></script>
</body>
</html>