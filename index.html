<!DOCTYPE html>
<html lang="fr" data-theme="light" data-color="blue">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="description" content="Courses Malin ‚Äì G√©rez vos listes de courses, suivez votre budget et organisez vos achats intelligemment.">
  <meta name="theme-color" content="#3B82F6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>Courses Malin ¬∑ Liste & Budget</title>
  <link rel="apple-touch-icon" sizes="180x180" href="assets/icon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/icon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/icon/favicon-16x16.png">
  <link rel="manifest" href="assets/manifest/site.webmanifest">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/style2.css">
  <!-- Cropper.js pour l'√©dition d'image -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css" />
  <style>
    /* Ajustements pour les ic√¥nes SVG */
    .sact-btn img {
      display: block;
      width: 24px;
      height: 24px;
    }
    .alist-share {
      padding: 0 8px;
    }
  </style>
</head>
<body>

  <header id="hdr" role="banner">
    <button class="hbtn" id="btnBack" aria-label="Retour √† l'accueil" style="display: none;">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <line x1="19" y1="12" x2="5" y2="12"/>
        <polyline points="12 19 5 12 12 5"/>
      </svg>
    </button>
    <div class="htitle-wrap">
      <img src="assets/images/LogoCourses.png" alt="" class="hlogo" id="headerLogo" aria-hidden="false" role="button" tabindex="0" aria-label="Afficher le logo en grand">
      <h1 id="htitle">Mes Courses</h1>
    </div>
    <button class="hbtn pri" id="btnAdd" aria-label="Ajouter un article">
      <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
        <line x1="12" y1="5" x2="12" y2="19"/>
        <line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
    </button>
  </header>

  <main id="content" role="main">
    <!-- ACCUEIL -->
    <section class="view on" id="v-home" aria-label="Accueil">
      <div class="card bcard" aria-label="Suivi du budget">
        <div class="brow">
          <span class="btag" data-i18n="home.budget">üí∞ Budget</span>
          <div class="btotal">
            <input type="number" id="budgetIn" step="1" min="0" value="50" aria-label="Budget total en euros" inputmode="decimal">
            <span aria-hidden="true">‚Ç¨</span>
          </div>
        </div>
        <div class="bstats">
          <div class="bst">
            <div class="bst-lbl" data-i18n="home.spent">D√©pens√©</div>
            <div class="bst-val" id="spentV" aria-live="polite">0.00 ‚Ç¨</div>
          </div>
          <div class="bst">
            <div class="bst-lbl" id="remLbl" data-i18n="home.remaining">Restant</div>
            <div class="bst-val" id="remV" aria-live="polite">50.00 ‚Ç¨</div>
          </div>
        </div>
        <div class="pbar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" id="pbarWrap">
          <div class="pfill" id="pfill" style="width:0%"></div>
        </div>
        <div class="balert" id="balert" role="alert" aria-live="assertive">
          ‚ö†Ô∏è <span id="balertTxt"></span>
        </div>
      </div>

      <!-- Indicateur de liste active -->
      <div class="alist" aria-label="Liste active s√©lectionn√©e">
        <span id="aListIco" aria-hidden="true">üõí</span>
        <div class="alist-info">
          <div class="alist-sub" data-i18n="home.active_list">Liste active</div>
          <div class="alist-name" id="aListName">Aucune liste</div>
        </div>
        <button class="alist-share" id="btnShare" aria-label="Partager la liste">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="18" cy="5" r="3"/>
            <circle cx="6" cy="12" r="3"/>
            <circle cx="18" cy="19" r="3"/>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
          </svg>
        </button>
        <!-- Importer une autre liste -->
        <button class="alist-share" id="btnImportToList" data-i18n-aria="home.import_list_aria" aria-label="Importer une autre liste">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
        </button>
        <!-- Changer de liste active (SVG) -->
        <button class="alist-share" id="btnChangeList" data-i18n-aria="home.change_list_aria" aria-label="Changer de liste active">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 2l4 4-4 4"/>
            <path d="M3 12h15.5M7 12c-1.5 0-2.5.5-3 1.5-1 2 0 4 2 5 2 1 4.5 0 5-2"/>
            <path d="M7 22l-4-4 4-4"/>
            <path d="M21 12h-15.5M17 12c1.5 0 2.5-.5 3-1.5 1-2 0-4-2-5-2-1-4.5 0-5 2"/>
          </svg>
        </button>
      </div>

      <!-- Carte du magasin -->
      <div id="listMapContainer" style="margin-bottom: 12px; display: none;">
        <div class="card" style="padding: 12px;">
          <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
            <span style="font-weight: 600;" data-i18n="home.map_title">üó∫Ô∏è Carte du magasin</span>
            <button class="sact-btn" id="viewMapBtn" data-i18n-aria="home.view_map_aria" aria-label="Voir la carte" style="padding: 5px 8px;">üëÅÔ∏è</button>
            <button class="sact-btn sact-muted" id="changeMapBtn" data-i18n-aria="home.change_map_aria" aria-label="Changer la carte" style="padding: 5px 8px;">üñäÔ∏è</button>
            <button class="sact-btn sact-danger" id="deleteMapBtn" data-i18n-aria="home.delete_map_aria" aria-label="Supprimer la carte" style="padding: 5px 8px;">üóëÔ∏è</button>
            <button class="sact-btn sact-muted" id="locateStoreBtn" data-i18n-aria="home.locate_store_aria" aria-label="Localiser le magasin" style="padding: 5px 8px;">üìç</button>
            <button class="sact-btn sact-muted" id="routeStoreBtn" data-i18n-aria="home.route_store_aria" aria-label="Itin√©raire" style="padding: 5px 8px;">üß≠</button>
          </div>
          <img id="mapThumb" src="" alt="Carte" style="max-width: 100%; max-height: 150px; margin-top: 8px; border-radius: var(--r-xs); display: none; cursor: pointer;">
        </div>
      </div>

      <!-- Barre de recherche -->
      <div class="sbar" role="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <circle cx="11" cy="11" r="8"/>
          <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <input type="search" id="searchIn" data-i18n="home.search_placeholder" placeholder="Rechercher un article‚Ä¶" aria-label="Rechercher dans la liste" autocomplete="off">
      </div>

      <!-- Liste des articles -->
      <div class="card" id="itemsCont" aria-label="Articles de la liste">
        <div class="empty" id="emptyState" style="cursor: pointer;" role="button" tabindex="0" aria-label="Ajouter un article ou cr√©er une liste">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
            <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
            <line x1="3" y1="6" x2="21" y2="6"/>
            <path d="M16 10a4 4 0 01-8 0"/>
          </svg>
          <h2 data-i18n="home.empty_title">Liste vide</h2>
          <p data-i18n="home.empty_text">Appuyez sur + pour ajouter votre premier article</p>
        </div>
        <ul id="itemsList" aria-label="Articles"></ul>
      </div>

      <!-- Barre de total -->
      <div class="tbar" aria-label="R√©sum√©">
        <span class="tbar-lbl" data-i18n="home.total_articles">Total articles</span>
        <span class="tbar-val" id="totCount" aria-live="polite">0 article</span>
      </div>
    </section>

    <!-- MES LISTES -->
    <section class="view" id="v-lists" aria-label="Mes listes de courses">
      <div class="vhdr">
        <h2 data-i18n="lists.title">Mes Listes</h2>
        <!-- Bouton "Nouvelle" supprim√© -->
      </div>
      <div style="display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; align-items: center;">
        <button class="sact-btn" id="btnExportLists" aria-label="Exporter en CSV">
          <img src="assets/images/iconeCSV.svg" width="24" height="24" alt="CSV">
        </button>
        <button class="sact-btn" id="btnImportLists" aria-label="Importer un fichier">
          <img src="assets/images/iconeIMPORT.svg" width="24" height="24" alt="Importer">
        </button>
        <button class="sact-btn" id="btnShareListsText" aria-label="Partager en texte">
          <img src="assets/images/iconeTXT.svg" width="24" height="24" alt="TXT">
        </button>
      </div>
      <div class="lgrid" id="lgrid" role="list" aria-label="Listes de courses"></div>
      <div class="empty" id="listsEmpty" style="display:none" aria-live="polite">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
          <rect x="3" y="3" width="18" height="18" rx="2"/>
          <line x1="8" y1="8" x2="16" y2="8"/>
          <line x1="8" y1="12" x2="16" y2="12"/>
          <line x1="8" y1="16" x2="12" y2="16"/>
        </svg>
        <h2 data-i18n="lists.empty_title">Aucune liste</h2>
        <p data-i18n="lists.empty_text">Cr√©ez votre premi√®re liste de courses</p>
      </div>
    </section>

    <!-- R√âGLAGES -->
    <section class="view" id="v-settings" aria-label="R√©glages de l'application">
      <h2 class="vtitle" data-i18n="settings.title">R√©glages</h2>
      <div class="ssec">
        <p class="stitle" data-i18n="settings.appearance">Apparence</p>
        <div class="sgroup">
          <div class="srow">
            <span class="slbl" data-i18n="settings.dark_mode">Mode sombre</span>
            <button class="tog" id="darkTog" role="switch" aria-checked="false" aria-label="Activer le mode sombre"></button>
          </div>
          <div class="srow srow-col">
            <span class="slbl" data-i18n="settings.primary_color">Couleur principale</span>
            <div class="cgrid" id="cGrid" role="group" aria-label="Choisir la couleur principale"></div>
          </div>
          <div class="srow">
            <span class="slbl" data-i18n="settings.language">Langue</span>
            <select id="langSelector" class="ssel" aria-label="Langue">
              <option value="fr">Fran√ßais</option>
              <option value="en">English</option>
              <option value="es">Espa√±ol</option>
              <option value="zh">‰∏≠Êñá</option>
              <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            </select>
          </div>
        </div>
      </div>
      <div class="ssec">
        <p class="stitle" data-i18n="settings.budget_alert">Alerte Budget</p>
        <div class="sgroup">
          <div class="srow">
            <span class="slbl" data-i18n="settings.enable_sound">Activer l'alerte sonore</span>
            <button class="tog" id="soundTog" role="switch" aria-checked="true" aria-label="Activer ou d√©sactiver l'alerte sonore"></button>
          </div>
          <div class="srow">
            <span class="slbl" data-i18n="settings.sound">Son d'alerte</span>
            <select class="ssel" id="soundSel" aria-label="Choisir le son d'alerte">
              <option value="A">Son A</option>
              <option value="B">Son B</option>
              <option value="C">Son C</option>
              <option value="D">Son D</option>
              <option value="E">Son E</option>
              <option value="F">Son F</option>
              <option value="G">Son G</option>
            </select>
          </div>
          <div class="srow">
            <span class="slbl" data-i18n="settings.test_sound">Tester le son</span>
            <button class="sact-btn" id="btnPlaySound" aria-label="Tester le son d'alerte">‚ñ∂</button>
          </div>
          <div class="srow">
            <span class="slbl" data-i18n="settings.stop_sound">Arr√™ter le son</span>
            <button class="sact-btn sact-muted" id="btnStopSound" aria-label="Arr√™ter le son d'alerte">‚èπ</button>
          </div>
          <div class="srow">
            <span class="slbl" data-i18n="settings.thresholds">Seuils d'alerte</span>
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              <label class="threshold-checkbox"><input type="checkbox" id="threshold50" checked> 50%</label>
              <label class="threshold-checkbox"><input type="checkbox" id="threshold80" checked> 80%</label>
              <label class="threshold-checkbox"><input type="checkbox" id="threshold100" checked> 100%</label>
            </div>
          </div>
        </div>
      </div>
      <div class="ssec">
        <p class="stitle" data-i18n="settings.tools">Outils</p>
        <div class="sgroup">
          <div class="srow">
            <span class="slbl" data-i18n="settings.calculator">Calculateur Conso</span>
            <a href="https://septieme7.github.io/Conso-Comptoir/" target="_blank" rel="noopener noreferrer" class="sact-btn" aria-label="Ouvrir la calculatrice (nouvel onglet)">üßÆ</a>
          </div>
          <div class="srow">
            <span class="slbl" data-i18n="settings.help">Aide</span>
            <button class="sact-btn" id="btnHelp" data-i18n="settings.help_button" aria-label="Aide">Ouvrir</button>
          </div>
          <div class="srow">
            <span class="slbl sbl-danger" data-i18n="settings.reset">R√©initialiser toutes les donn√©es</span>
            <button class="sact-btn sact-danger" id="btnReset" data-i18n="settings.reset_button" aria-label="Effacer toutes les donn√©es">Effacer</button>
          </div>
        </div>
      </div>
      <p class="app-version">Courses Malin ¬∑ v2.7</p>
    </section>

    <!-- AIDE -->
    <section class="view" id="v-help" aria-label="Aide">
      <h2 class="vtitle" data-i18n="help.title">Aide</h2>
      <div class="card" style="padding: 16px;">
        <!-- ... contenu inchang√© ... -->
      </div>
    </section>
  </main>

  <nav id="nav" role="navigation" aria-label="Navigation principale">
    <button class="tab on" id="t-home" aria-label="Accueil" aria-current="page">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
        <polyline points="9 22 9 12 15 12 15 22"/>
      </svg>
      <span data-i18n="nav.home">Accueil</span>
    </button>
    <button class="tab" id="t-lists" aria-label="Mes Listes">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <line x1="8" y1="6" x2="21" y2="6"/>
        <line x1="8" y1="12" x2="21" y2="12"/>
        <line x1="8" y1="18" x2="21" y2="18"/>
        <line x1="3" y1="6" x2="3.01" y2="6"/>
        <line x1="3" y1="12" x2="3.01" y2="12"/>
        <line x1="3" y1="18" x2="3.01" y2="18"/>
      </svg>
      <span data-i18n="nav.lists">Mes Listes</span>
    </button>
    <button class="tab" id="t-settings" aria-label="R√©glages">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <circle cx="12" cy="12" r="3"/>
        <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/>
      </svg>
      <span data-i18n="nav.settings">R√©glages</span>
    </button>
  </nav>

  <!-- FAB pour l'accueil -->
  <button id="fab" class="pulse" aria-label="Ajouter un article">
    <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
      <line x1="12" y1="5" x2="12" y2="19"/>
      <line x1="5" y1="12" x2="19" y2="12"/>
    </svg>
  </button>

  <!-- Nouveau FAB pour Mes Listes -->
  <button id="fab-list" class="fab-secondary" aria-label="Cr√©er une nouvelle liste" style="display: none;">
    <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="3" aria-hidden="true">
      <line x1="12" y1="5" x2="12" y2="19"/>
      <line x1="5" y1="12" x2="19" y2="12"/>
    </svg>
  </button>

  <div id="ovl" aria-hidden="true"></div>

  <!-- Bottom Sheet : Ajouter / Modifier un article -->
  <div class="sheet" id="shItem" role="dialog" aria-modal="true" aria-labelledby="shItemTitle">
    <div class="shandle" aria-hidden="true"></div>
    <h2 class="stit" id="shItemTitle">Ajouter un article</h2>
    <div class="sbody">
      <div class="fld">
        <label data-i18n="item.quick_suggestions">Suggestions rapides <span class="hint" data-i18n="item.click_to_add">(cliquez pour cumuler)</span></label>
        <div class="chips" id="qChips" role="group" aria-label="Suggestions rapides"></div>
      </div>

      <div class="fld">
        <label for="iName">
          <span data-i18n="item.name_label">Nom</span>
          <span aria-hidden="true">*</span>
          <span class="hint" data-i18n="item.name_hint"> ‚Äî s√©parez par une virgule pour en ajouter plusieurs</span>
        </label>
        <div style="display: flex; gap: 8px;">
          <input type="text" id="iName" data-i18n="item.name_placeholder" placeholder="Ex : Pain, Lait, Beurre‚Ä¶" autocomplete="off" aria-required="true" aria-describedby="iNameHint" style="flex: 1;">
          <button type="button" id="btnScanBarcode" class="sact-btn" style="padding: 0 8px;" aria-label="Scanner un code-barres">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M2 8V6a2 2 0 0 1 2-2h2M2 16v2a2 2 0 0 0 2 2h2M22 8V6a2 2 0 0 0-2-2h-2M22 16v2a2 2 0 0 1-2 2h-2M4 12h16M8 12v4M16 12v4"/>
            </svg>
          </button>
          <button type="button" id="btnSpeech" class="sact-btn" style="padding: 0 8px;" aria-label="Ajouter par la voix">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2a3 3 0 0 0-3 3v6a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
              <path d="M19 10v1a7 7 0 0 1-14 0v-1M12 19v3M8 22h8"/>
            </svg>
          </button>
        </div>
        <p class="multi-hint" id="iNameHint"></p>
      </div>

      <!-- Mode scan multiple -->
      <div class="fld" style="display: flex; align-items: center; justify-content: space-between;">
        <label for="multiScanToggle" data-i18n="item.multi_scan">Mode scan multiple</label>
        <button class="tog" id="multiScanToggle" role="switch" aria-checked="false"></button>
      </div>

      <!-- Conteneur pour la cam√©ra -->
      <div id="scannerContainer" style="display: none; margin-top: 10px; border-radius: var(--r-sm); overflow: hidden; background: #000; min-height: 250px;">
        <div id="qr-reader" style="width: 100%;"></div>
        <div style="display: flex; gap: 8px; padding: 8px; justify-content: center;">
          <button class="sact-btn sact-muted" id="btnStopScan" data-i18n="item.stop_scan">Arr√™ter</button>
        </div>
        <!-- Panneau de r√©sultat pour le scan multiple -->
        <div id="scanResultPanel" style="display: none; background: var(--sur); padding: 10px; border-radius: 8px; margin-top: 8px;">
          <div id="scanProductName" style="font-weight: 600; margin-bottom: 5px;"></div>
          <div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">
            <button class="sact-btn sact-muted" id="scanIgnoreBtn" data-i18n="item.scan_ignore">Ignorer</button>
            <button class="sact-btn" id="scanAddBtn" data-i18n="item.scan_add">Ajouter</button>
            <button class="sact-btn sact-danger" id="scanStopBtn" data-i18n="item.scan_stop">Arr√™ter</button>
          </div>
        </div>
      </div>

      <div class="fld" id="fldQty">
        <label id="qtyLbl" data-i18n="item.quantity">Quantit√©</label>
        <div class="stepper" role="group" aria-labelledby="qtyLbl">
          <button class="stbtn" id="qtyMinus" aria-label="Diminuer la quantit√©">‚àí</button>
          <span class="stval" id="qDisp" aria-live="polite">1</span>
          <button class="stbtn" id="qtyPlus" aria-label="Augmenter la quantit√©">+</button>
        </div>
      </div>
      <div class="fld" id="fldPrice">
        <label for="iPrice" data-i18n="item.price_label">Prix unitaire (‚Ç¨)</label>
        <input type="number" id="iPrice" data-i18n="item.price_placeholder" placeholder="0.00" step="0.01" min="0" inputmode="decimal">
      </div>

      <!-- Unit√© et prix au kilo -->
      <div class="fld" id="fldUnit">
        <label for="iUnit" data-i18n="item.unit_label">Unit√©</label>
        <select id="iUnit">
          <option value="pce" data-i18n="units.piece">pi√®ce</option>
          <option value="kg" data-i18n="units.kg">kilogramme (kg)</option>
          <option value="g" data-i18n="units.g">gramme (g)</option>
          <option value="l" data-i18n="units.l">litre (L)</option>
          <option value="ml" data-i18n="units.ml">millilitre (mL)</option>
          <option value="pack" data-i18n="units.pack">paquet</option>
        </select>
      </div>
      <div class="fld" id="fldPricePerUnit" style="display: none;">
        <label for="iPricePerUnit" data-i18n="item.price_per_unit_label">Prix au kg/L (‚Ç¨)</label>
        <input type="number" id="iPricePerUnit" step="0.01" min="0" placeholder="0.00">
      </div>

      <div class="fld">
        <label for="iCat" data-i18n="item.category_label">Cat√©gorie</label>
        <div style="display: flex; gap: 8px; align-items: center;">
          <select id="iCat" style="flex: 1;">
            <option value="" data-i18n="item.no_category">Sans cat√©gorie</option>
            <option value="ü•¶ Fruits &amp; L√©gumes" data-i18n="category.fruits">ü•¶ Fruits & L√©gumes</option>
            <option value="ü•© Viandes &amp; Poissons" data-i18n="category.meat">ü•© Viandes & Poissons</option>
            <option value="ü•õ Produits Laitiers" data-i18n="category.dairy">ü•õ Produits Laitiers</option>
            <option value="ü•ñ Boulangerie" data-i18n="category.bakery">ü•ñ Boulangerie</option>
            <option value="ü•´ √âpicerie" data-i18n="category.grocery">ü•´ √âpicerie</option>
            <option value="üß¥ Hygi√®ne" data-i18n="category.hygiene">üß¥ Hygi√®ne</option>
            <option value="üßπ Entretien" data-i18n="category.cleaning">üßπ Entretien</option>
            <option value="üßÉ Boissons" data-i18n="category.drinks">üßÉ Boissons</option>
            <option value="üç¶ Surgel√©s" data-i18n="category.frozen">üç¶ Surgel√©s</option>
            <option value="üíï Love" data-i18n="category.love">üíï Love</option>
            <option value="ü§¨ SaM√©reList" data-i18n="category.mother">ü§¨ SaM√©reList</option>
            <option value="üñï Sheet List" data-i18n="category.sheet">üñï Sheet List</option>
            <option value="üßô‚Äç‚ôÇÔ∏è Magic List" data-i18n="category.magic">üßô‚Äç‚ôÇÔ∏è Magic List</option>
          </select>
          <button type="button" id="btnManageCategories" class="sact-btn" style="padding: 0 8px;" aria-label="G√©rer les cat√©gories">‚öôÔ∏è</button>
        </div>
      </div>

      <div class="fld" id="fldNote">
        <label for="iNote" data-i18n="item.note_label">Note / Marque</label>
        <textarea id="iNote" data-i18n="item.note_placeholder" placeholder="Pr√©cisions, marque pr√©f√©r√©e‚Ä¶"></textarea>
      </div>
      <button class="sbtn pri" id="iSubmit" data-i18n="item.add_button" disabled>Ajouter</button>
    </div>
  </div>

  <!-- Bottom Sheet : Cr√©er une liste -->
  <div class="sheet" id="shList" role="dialog" aria-modal="true" aria-labelledby="shListTitle">
    <div class="shandle" aria-hidden="true"></div>
    <h2 class="stit" id="shListTitle" data-i18n="lists.new_list_title">Nouvelle liste</h2>
    <div class="sbody">
      <div class="fld">
        <label for="lName" data-i18n="lists.name_label">Nom <span aria-hidden="true">*</span></label>
        <input type="text" id="lName" data-i18n="lists.name_placeholder" placeholder="Ex : Supermarch√©, Semaine‚Ä¶" autocomplete="off" aria-required="true">
      </div>
      <div class="fld">
        <label for="lEmoji" data-i18n="lists.emoji_label">Emoji</label>
        <div class="chips" id="eChips" role="group" aria-label="Choisir un emoji"></div>
        <input type="text" id="lEmoji" value="üõí" maxlength="4" class="emoji-input" aria-label="Emoji de la liste">
      </div>
      <div class="fld">
        <label data-i18n="lists.color_label">Couleur</label>
        <div class="cgrid" id="lCGrid" role="group" aria-label="Choisir la couleur de la liste"></div>
        <input type="hidden" id="lColor" value="#3B82F6">
      </div>
      <button class="sbtn pri" id="lSubmit" data-i18n="lists.create_button" disabled>Cr√©er la liste</button>
    </div>
  </div>

  <!-- Bottom Sheet : √âditeur d'image (recadrage, rotation) -->
  <div class="sheet" id="shImageEditor" role="dialog" aria-modal="true" aria-labelledby="shImageTitle">
    <div class="shandle" aria-hidden="true"></div>
    <h2 class="stit" id="shImageTitle">√âditer l'image</h2>
    <div class="sbody">
      <div style="max-height: 50vh; overflow: hidden; margin-bottom: 16px;">
        <img id="imageToEdit" src="" style="max-width: 100%; display: block;">
      </div>
      <div style="display: flex; gap: 8px; justify-content: center; margin-bottom: 16px; flex-wrap: wrap;">
        <button class="sact-btn sact-muted" id="btnRotateLeft" aria-label="Tourner √† gauche">‚Ü∫ 90¬∞</button>
        <button class="sact-btn sact-muted" id="btnRotateRight" aria-label="Tourner √† droite">‚Üª 90¬∞</button>
        <button class="sact-btn sact-muted" id="btnFlipHorizontal" aria-label="Retourner horizontalement">‚Üî</button>
        <button class="sact-btn sact-muted" id="btnFlipVertical" aria-label="Retourner verticalement">‚Üï</button>
      </div>
      <div style="display: flex; gap: 8px;">
        <button class="sbtn sact-muted" id="btnCancelImageEdit" style="flex:1;">Annuler</button>
        <button class="sbtn pri" id="btnSaveImageEdit" style="flex:1;">Valider</button>
      </div>
    </div>
  </div>

  <!-- Bottom Sheet : Export de listes (et partage texte / import) -->
  <div class="sheet" id="shExport" role="dialog" aria-modal="true" aria-labelledby="shExportTitle">
    <div class="shandle" aria-hidden="true"></div>
    <h2 class="stit" id="shExportTitle">Exporter des listes</h2>
    <div class="sbody">
      <p data-i18n="export.select_prompt">S√©lectionnez les listes √† exporter :</p>
      <div id="exportListCheckboxes" style="margin: 16px 0;">
        <!-- Les checkboxes seront g√©n√©r√©es dynamiquement -->
      </div>
      <div style="display: flex; gap: 8px;">
        <button class="sbtn sact-muted" id="btnCancelExport" data-i18n="common.cancel" style="flex:1;">Annuler</button>
        <button class="sbtn pri" id="btnConfirmExport" data-i18n="common.confirm" style="flex:1;">Confirmer</button>
      </div>
    </div>
  </div>

  <!-- Bottom Sheet : Gestion des cat√©gories (nouveau, accessible depuis le formulaire d'ajout) -->
  <div class="sheet" id="shCategoryEdit" role="dialog" aria-modal="true" aria-labelledby="shCategoryEditTitle">
    <div class="shandle" aria-hidden="true"></div>
    <h2 class="stit" id="shCategoryEditTitle" data-i18n="categories.edit_title">Modifier la cat√©gorie</h2>
    <div class="sbody">
      <div id="categoryForm" style="display: block; margin-top: 16px;">
        <div class="fld">
          <label for="catName" data-i18n="categories.name">Nom</label>
          <input type="text" id="catName" placeholder="Ex: Fruits">
        </div>
        <div class="fld">
          <label for="catEmoji" data-i18n="categories.emoji">Emoji</label>
          <div class="chips" id="catEmojiChips" role="group" aria-label="Choisir un emoji"></div>
          <input type="text" id="catEmoji" value="ü•¶" maxlength="4" class="emoji-input">
        </div>
        <div class="fld">
          <label for="catColor" data-i18n="categories.color">Couleur</label>
          <div class="cgrid" id="catColorGrid" role="group" aria-label="Choisir une couleur"></div>
          <input type="hidden" id="catColor" value="#10B981">
        </div>
        <div style="display: flex; gap: 8px;">
          <button class="sbtn sact-muted" id="btnCancelCategoryEdit" style="flex:1;" data-i18n="common.cancel">Annuler</button>
          <button class="sbtn pri" id="btnSaveCategory" style="flex:1;" data-i18n="common.save">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal pour afficher le logo ou la carte en grand -->
  <div id="logoModal" class="modal" onclick="closeLogoModal()" role="dialog" aria-modal="true" aria-label="Logo agrandi" style="display: none;">
    <img src="assets/images/LogoCourses.png" alt="Logo Courses Malin">
  </div>

  <div id="snk" role="status" aria-live="polite"></div>

  <!-- Biblioth√®ques externes -->
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

  <!-- Nouveaux scripts -->
  <script src="assets/js/i18n.js"></script>
  <script src="assets/js/units.js"></script>
  <script src="assets/js/dragdrop.js"></script>
  <script src="assets/js/speech.js"></script>
  <script src="assets/js/geolocation.js"></script>
  <script src="assets/js/script.js"></script>
</body>
</html>